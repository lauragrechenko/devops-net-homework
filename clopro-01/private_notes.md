
```
│  Yandex Cloud                                                            │
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐  │
│  │  VPC Network: clopro-dev-vpc                                       │  │
│  │                                                                    │  │
│  │  ┌──────────────────────────────────┐   ┌────────────────────────┐ │  │
│  │  │ Public Subnet                    │   │ Private Subnet         │ │  │
│  │  │ 192.168.10.0/24                  │   │ 192.168.20.0/24        │ │  │
│  │  │                                  │   │                        │ │  │
│  │  │  ┌────────────────────────────┐  │   │  ┌───────────────────┐ │ │  │
│  │  │  │ VM: public-vm              │  │   │  │ VM: private-vm    │ │ │  │
│  │  │  │ External IP: yes           │  │   │  │ External IP: No   │ │ │  │
│  │  │  │ Internal IP: 192.168.10.X  │  │   │  │ Internal IP:      │ │ │  │
│  │  │  └────────────────────────────┘  │   │  │ 192.168.20.Y      │ │ │  │
│  │  │                                  │   │  └─────────┬─────────┘ │ │  │
│  │  │  ┌────────────────────────────┐  │   │            │           │ │  │
│  │  │  │ VM: nat-instance           │  │   │            │ egress    │ │  │
│  │  │  │ Internal IP: 192.168.10.254│  │   │            │ trafic    │ │  │
│  │  │  │ External IP: yes           │  │   │            ▼           │ │  │
│  │  │  │ image_id: fd80...          │  │   │   ┌──────────────────┐ │ │  │
│  │  │  └────────────────────────────┘  │   │   │ Route table      │ │ │  │
│  │  └──────────────────────────────────┘   │   │ (attached to     │ │ │  │
│  │                                         │   │  PRIVATE subnet) │ │ │  │
│  │                                         │   │ 0.0.0.0/0 ->     │ │ │  │
│  │                                         │   │ 192.168.10.254   │ │ │  │
│  │                                         │   └──────────────────┘ │ │  │
│  │                                         └────────────────────────┘ │  │
│  └────────────────────────────────────────────────────────────────────┘  │
└──────────────────────────────────────────────────────────────────────────┘


SSH (access):
  My laptop ──SSH──► public-vm (external IP) ──SSH──► private-vm (192.168.20.Y)

Internet (egress):
  public-vm  ───────────────────────────────► Internet   (direct via its own external IP)
  private-vm ─► Route table (0.0.0.0/0) ─► nat-instance (192.168.10.254) ─► Internet
```



```
│ AWS Region: eu-central-1                                                       │
│                                                                                │
│  ┌──────────────────────────────────────────────────────────────────────────┐  │
│  │ VPC: clopro-dev-vpc (192.168.0.0/16)                                     │  │
│  │                                                                          │  │
│  │  ┌──────────────────────────────────────┐   ┌─────────────────────────┐  │  │
│  │  │ Public Subnet (192.168.10.0/24)      │   │ Private Subnet          │  │  │
│  │  │ map_public_ip_on_launch: true        │   │ (192.168.20.0/24)       │  │  │
│  │  │ AZ: eu-central-1a                    │   │ map_public_ip: false    │  │  │
│  │  │                                      │   │ AZ: eu-central-1a       │  │  │
│  │  │  ┌───────────────────────────────┐   │   │  ┌────────────────────┐ │  │  │
│  │  │  │ EC2: public-vm                │   │   │  │ EC2: private-vm    │ │  │  │
│  │  │  │ Public IP: auto               │   │   │  │ Public IP: no      │ │  │  │
│  │  │  │ SG: public-ssh (22 from MyIP) │   │   │  │ SG: private-ssh (22│ │  │  │
│  │  │  └───────────────┬───────────────┘   │   │  │ from public-vm SG  │ │  │  │
│  │  │                  │ SSH jump          │   │  └──────────┬─────────┘ │  │  │
│  │  │                  │ (only)            │   │             │ egress    │  │  │
│  │  │  ┌───────────────▼───────────────┐   │   │  ┌──────────▼──────────┐│  │  │
│  │  │  │ NAT Gateway: clopro-dev-nat-gw│   │   │  │ Route Table: private││  │  │
│  │  │  │ EIP: <public static IP>       │   │   │  │ 0.0.0.0/0 → NAT GW  ││  │  │
│  │  │  └───────────────┬───────────────┘   │   │  └─────────────────────┘│  │  │
│  │  │                  │                   │   │                         │  │  │
│  │  │  ┌───────────────▼───────────────┐   │   │(local route внутри VPC) │  │  │
│  │  │  │ Route Table: public           │   │   │192.168.0.0/16 → local   │  │  │
│  │  │  │ 0.0.0.0/0 → IGW               │   │   │(по нему public-vm       │  │  │
│  │  │  └───────────────┬───────────────┘   │   │достучится до private-vm)│  │  │
│  │  │                  │                   │   │                         │  │  │
│  │  │  ┌───────────────▼───────────────┐   │   └─────────────────────────┘  │  │
│  │  │  │ Internet Gateway (IGW)        │   │                                │  │
│  │  │  └───────────────┬───────────────┘   │                                │  │
│  └─────────────────────┼───────────────────┘                                │  │
└────────────────────────┼────────────────────────────────────────────────────┘
                         │
                    ┌────▼────┐
                    │ Internet│
                    └─────────┘

SSH access:
  My IP ──SSH──► public-vm ──SSH (private IP)──► private-vm

Internet egress:
  public-vm  ───────────────► IGW ─► Internet
  private-vm ─► private-rt ─► NAT GW ─► public-rt ─► IGW ─► Internet
```
